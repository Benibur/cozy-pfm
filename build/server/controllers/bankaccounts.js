// Generated by CoffeeScript 1.7.1
var BankAccess, BankAccount, BankOperation;

BankAccount = require('../models/bankaccount');

BankOperation = require('../models/bankoperation');

BankAccess = require('../models/bankaccess');

module.exports.loadBankAccount = function(req, res, next, accountID) {
  return BankAccount.find(accountID, (function(_this) {
    return function(err, account) {
      if ((err != null) || (account == null)) {
        return res.send(404, {
          error: "BankAccount not found"
        });
      } else {
        _this.account = account;
        return next();
      }
    };
  })(this));
};

module.exports.index = function(req, res) {
  return BankAccount.all(function(err, accounts) {
    if (err != null) {
      return res.send(500, {
        error: 'Server error occurred while retrieving data'
      });
    } else {
      return res.send(200, accounts);
    }
  });
};

module.exports.destroy = function(req, res) {
  return this.account.destroyWithOperations(function(err) {
    if (err != null) {
      return res.send(500, {
        error: err
      });
    } else {
      return res.send(204, {
        success: true
      });
    }
  });
};

module.exports.show = function(req, res) {
  return res.send(200, this.account);
};

module.exports.getOperations = function(req, res) {
  return BankOperation.allFromBankAccountDate(this.account, function(err, operations) {
    if (err != null) {
      return res.send(500, {
        error: 'Server error occurred while retrieving data'
      });
    } else {
      return res.send(200, operations);
    }
  });
};

module.exports.retrieveOperations = function(req, res) {
  return BankAccess.find(this.account.bankAccess, (function(_this) {
    return function(err, access) {
      var msg;
      if (err != null) {
        msg = "Server error occurred while retrieving data -- " + err;
        return res.send(500, {
          error: msg
        });
      } else {
        return access.retrieveOperations(function(err) {
          if (err != null) {
            msg = "Server error occurred while retrieving data";
            return res.send(500, {
              error: "" + msg + " -- " + err
            });
          } else {
            return res.send(200, _this.account);
          }
        });
      }
    };
  })(this));
};
